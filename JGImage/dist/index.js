!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";isc.ClassFactory.defineClass("JGImage","JGBaseWidget"),isc.ClassFactory.mixInInterface("JGBaseWidget","IRecordObserver"),isc.JGImage.addProperties({widgetId:"JGImage1",ToolTip:"",Placeholder:"",code:"JGImage1",Left:0,HorizontalAlign:"Left",type:"JGImage",ColSpan:"1",TabIndex:30,WidgetStyle:"JGImage",PercentHeight:"6%",Visible:!0,listener:["OnClick"],Height:100,AutoTest:!0,Width:100,_$windowVersion:"1",SourceTableName:"virtualDB_JGImage_JGImage1",StaticLayoutSize:!0,VerticalAlign:"Top",EndRow:"False",ImageObject:"",ImagePosition:"contain",Code:"JGImage1",MultiHeight:"100px",OnClick:"",PlaceholderPosition:"Right",StartRow:"False",TableName:"",Dock:"None",_$WidgetType:"JGImage",Top:0,Alias:"图片",ImageMouse:"Default",MultiWidth:"100px",PercentWidth:"5.4%",ImageValue:"",ColumnName:"ImageObj",_blankSrc:"itop/common/images/defaultImg.png"}),isc.JGImage.addMethods({getStaticImagePath:function(e){return window&&window._$basePath?window._$basePath+e:e},_initWidget:function(){this.TableName&&this.TableName.addObserver(this),this.ImageObj=this.ImageValue,null!=this.ImageValue&&-1!=this.ImageValue.indexOf("/")&&(this.ImageValue=this.ImageValue.substring(this.ImageValue.lastIndexOf("/")+1)),null!=this.ImageMouse&&("Default"==this.ImageMouse?this.ImageMouse="default":"Hand"==this.ImageMouse?this.ImageMouse="pointer":"IBeam"==this.ImageMouse&&(this.ImageMouse="text"));var e=this.ImageObj?this.ImageObj:this._blankSrc;this.src=this.getStaticImagePath(e),this.disabled=!1,this.className=this.WidgetStyle+"Stack";var i="None"==this.Dock?this.Height:"100%",t="None"==this.Dock?this.Width:"100%",s={height:i,cursor:this._handleImageMouse(),width:t,statelessImage:!0,imageType:isc.Img.CENTER,overflow:isc.Canvas.HIDDEN,src:null,imagePosition:this.ImagePosition,hoverWidth:250,title:this.ImageValue};this.appImgDir&&(s.appImgDir=this.appImgDir),this.img=this.createAutoChild("img",s,isc.Img),this.setSrc(e,this.type),this.addChild(this.img),this.click=this._handleClick},setSrc:function(e,i){var t=this;this.img&&(e?(e=isc.Page.getAppImgDir(e),"JGImage"===i?(e=e.replace(/\\/g,"/"),this._imgUrl=e,this._imgObj=new Image,this._imgObj.onload=function(){t._imgUrl===this.src&&(t.fitImageSize(this.width,this.height),t.img.setSrc(e),t.img.markForRedraw())},this._imgObj.src=e):isc.JGImageHelper.imageReady(e,(function(){t.fitImageSize(this.width,this.height),t.img.setSrc(e),t.img.markForRedraw()}))):(this.img.src=null,this.img.markForRedraw()))},fitImageSize:function(e,i){this.img._realImageWidth=e,this.img._realImageHeight=i;var t=this.img.getInnerWidth(),s=this.img.getInnerHeight();this.ImagePosition+""=="fill"?(this.img.imageHeight=s,this.img.imageWidth=t):e<=t&&i<=s?(this.img.imageHeight=i,this.img.imageWidth=e):e/i>=t/s?(this.img.imageWidth=t,this.img.imageHeight=i*t/e):(this.img.imageHeight=s,this.img.imageWidth=e*s/i)},destroy:function(){var e=this.img;e&&(this.img=null,e.destroy()),this.Super("destroy",arguments)},_handleImageMouse:function(){return this.ImageMouse+""!="default"?this.ImageMouse:this.OnClick+""!=""?"pointer":"default"},resized:function(){var e=this.img&&this.img._realImageHeight,i=this.img&&this.img._realImageWidth;e&&i&&this.fitImageSize(i,e),this.Super(arguments,"resized")},_handleClick:function(){this._referTimerEventHandler(this,[this._setFocus,"OnClick"])},bindDataSource:function(e){this.dataSource=e;var i=isc.JGV3ValuesManager.getByDataSource(e);i.getMember(this.ID)||i.addMember(this)},getBoundFieldNames:function(){return[this.ColumnName]},_referTimerEventHandler:function(e,i){isc.isAn.Array(i)||(i=[i]);var t=e.ID,s=this.getWindow()[t];if(!s)throw Error("不存在["+t+"]对象，请检查！");if(i&&i.length>0)for(var a=0,n=i.length;a<n;a++){var h=i[a];if("function"==typeof h)h.apply(s,arguments);else{var g=s.listener[h];if(g&&g.length>0)for(var r=0,m=g.length;r<m;r++){var o=g[r];isc.TimerEventHandler.push((function(){var e=window[t];e&&e.pause&&e.pause()})),isc.TimerEventHandler.push((function(){var e=window[t];e&&(o.apply(e,arguments),e.resume&&!e.destroyed&&e.resume())})),isc.TimerEventHandler.run()}}}},_referPartFunc:function(){this._referFuncs(this,["clearValues","editRecord","editNewRecord"])},pause:function(){this.setDisabled(!0)},resume:function(){this.setDisabled(!1)},_setFocus:function(){this.focus()},getImageValue:function(){return this.ImageValue},setImageValue:function(e){this.ImageValue=e,this.redraw()},setItemValues:function(e){if(null!=e&&null!=e&&!isc.isA.emptyObject(e)){var i=e[this.ColumnName]?e[this.ColumnName]:"";this.setValue(i)}},setValue:function(e){if(e+""!="undefined"&&e+""!="null"&&""!==e){var i=this;if(!i)return;if(e.indexOf("itop/vjs/icons")>-1)i.setSrc(e,this.WidgetStyle);else if(e.startsWith("/"))i.setSrc(e.substring(1),this.WidgetStyle);else if(0===e.indexOf("http"))i.setSrc(e,this.WidgetStyle);else{var t="module-operation!executeOperation?operation=FileDown&token=%7B%22data%22%3A%7B%22dataId%22%3A%22"+e+"%22%2C%22ImageObj%22%3A%22"+e+"%22%7D%7D";this.ImageObj=t,i.setSrc(t,this.WidgetStyle)}}else this.reset()},setImageUrl:function(e){this.ImageObj=e,this.setSrc(e,this.WidgetStyle)},getImageUrl:function(){return this.ImageObj},reset:function(){this.ImageObj=this._blankSrc,this.setSrc(this._blankSrc,this.WidgetStyle)},setPercentWidth:function(e){this.setWidth(e)},setPercentHeight:function(e){this.setHeight(e)},editRecord:function(e){var i=e[this.ColumnName];this.setValue(i)},clearValue:function(){this.reset()},getBindFields:function(){return[this.ColumnName]},setWidgetData:function(e){this.setValue(e)},clearWidgetData:function(){this.clearValue()}})}));
