!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";isc.ClassFactory.defineClass("JGBaseFormWidget","JGFormWidget"),isc.ClassFactory.mixInInterface("JGBaseFormWidget","IRecordObserver"),isc.JGBaseFormWidget.addProperties({isPositionForm:!0,form:null,formConstructor:isc.FormItemView,formDefaults:{cellPadding:0,width:222,height:24,writeFormTag:!1,errorOrientation:"right"},titlePrefix:'<div class="formLabel">',titleLinkPrefix:'<div class = "formLabel s-linked">',titleSuffix:"</div>",requiredTitlePrefix:'<div class="formLabel">',requiredTitleLinkPrefix:'<div class="formLabel s-linked">',requiredTitleSuffix:"</div>",className:"JGBaseFormWidget",positionStyleName:"absoluteFormLayout",requiredStyleName:"absoluteRequiredForm",VerticalAlign:"Top",HorizontalAlign:"Left",_v3ExpHandler:function(t){return t}}),isc.JGBaseFormWidget.addMethods({init:function(t){this._initProperties(t),"Striking"==this.IsMustBehavior&&(this.items[0].required=this.IsMust),this.id=isc.WidgetUtils.genWidgetRefId(this.scopeId,this.widgetId),this.styleName=this.className+" "+this.positionStyleName,this.IsMust&&(this.styleName+=" "+this.requiredStyleName),this.canEdit=!this.ReadOnly,this.autoDraw=!1,this.left=this.Left,this.top=this.Top,isc.isA.Boolean(this.Visible)&&(this.visibility=this.Visible?isc.Canvas.INHERIT:isc.Canvas.HIDDEN),this.width=this.Width,this.height=this.Height,this.writeFormTag=!1,this.items[0].hint||(this.items[0].hint=this.items[0].Placeholder),this.items[0].showHintInField=!0,isc.JGWidgetManager.putWidget(this.id,this),this.Super("init",arguments),this.getTitleHTML=function(t,e,i){t.titleHasLink=!(!t.OnLabelClick||""==t.OnLabelClick),this.titleSuffix="",this.requiredTitleSuffix='&nbsp;<span class="required">*</span>';var s=isc.StringBuffer.create(),n=t.visible?t.getTitleHTML():null;if(n){var r=$(n),a={},o=this.getLabelFontStyle&&this.getLabelFontStyle();if(o)try{var l=JSON.parse(o);l&&(a=l)}catch(t){}var h=this.getLabelForeColor&&this.getLabelForeColor();h&&(a.color=isc.JGStyleTools.toColor(h));var d=this.getLabelBackColor&&this.getLabelBackColor();if(d&&(a["background-color"]=isc.JGStyleTools.toColor(d)),a["text-align"]=this.LabelTextAlign,t.isSingleLabel&&t.isSingleLabel()){var g=t.getSingleLabelStyle();if(g)for(var c in g)g.hasOwnProperty(c)&&(a[c]=g[c])}r.css(a),n=r[0].outerHTML;var u=this.isRequired(t,!0),f=this.getTitleOrientation(t),p=f==isc.Canvas.LEFT||f==isc.Canvas.TOP;if(i){var m,y,v=this.$114z;u&&this.hiliteRequiredFields?(""==t.title&&(this.requiredTitleSuffix='<span class="required">*</span>'),m=p?this.requiredTitlePrefix:this.requiredRightTitlePrefix,y=p?this.requiredTitleSuffix:this.requiredRightTitleSuffix):(""==t.title&&(this.titlePrefix="",this.rightTitlePrefix="",this.titleSuffix="",this.rightTitleSuffix="",this.titleLinkPrefix=""),m=p?this.titlePrefix:this.rightTitlePrefix,y=p?this.titleSuffix:this.rightTitleSuffix);var b=this.$207z(m,y);v[1]=b[0],v[2]=y,v[4]=this.$1140(t),v[10]=m,v[11]=n,v[12]=b[1],s.append.apply(s,v)}else""==t.title&&(this.titlePrefix="",this.rightTitlePrefix="",this.titleSuffix="",this.rightTitleSuffix="",this.titleLinkPrefix="",this.requiredTitleSuffix='<span class="required">*</span>'),s.append(u&&this.hiliteRequiredFields?p?this.requiredTitlePrefix:this.requiredRightTitlePrefix:p?this.titlePrefix:this.rightTitlePrefix,u&&this.hiliteRequiredFields?p?this.requiredTitleSuffix:this.requiredRightTitleSuffix:p?this.titleSuffix:this.rightTitleSuffix,n)}else s.append("&nbsp;");return s.release(!1)},this._afterInit()},_afterInit:function(){isc.V3Datasource.isA(this.TableName)&&(this.TableName&&this.TableName.addObserver&&this.TableName.addObserver(this),this.bindDataSource&&this.bindDataSource(this.TableName),this.ColumnName=this.ColumnName?this.ColumnName:"ColumnName",this.onLoadListener(this.OnValueLoaded),this.onChangedListener(this.OnValueChanged))},showError:function(){if("Striking"==this.IsMustBehavior){var t=this.items[0];if(t.getError()){var e=t.eErrorCanvas,i=this.TitleWidth+this.getPageLeft(),s=this.getPageTop()+t.height+10;(this.getPageTop()>38||document.documentElement.clientHeight<s)&&(s=this.getPageTop()-38);var n=(a=this.getParentElements())[a.length-1];if(s-=n.getPageTop(),i-=n.getPageLeft(),s<0&&(s=38),e)e.tmrID&&(e.tmrID=isc.Timer.clear(e.tmrID),e.tmrID=null),e.moveTo(i,s);else{var r=this.getDefaultMustTipWidth?this.getDefaultMustTipWidth():122;e=t.eErrorCanvas=isc.Canvas.create({width:r,height:34,left:i,top:s});var a,o=this.getPageTop()-38;s==o||s==o-n.getPageTop()?e.contents='<div class="tips"><div class="ico-tips-top"></div><span class="iconfont icon-warn JGFormErrorIcon"></span>此项为必填项</div>':e.contents='<div class="tips"><div class="ico-tips-bottom"></div><span class="iconfont icon-warn JGFormErrorIcon"></span>此项为必填项</div>',(a=this.getParentElements())[a.length-1].addChild(e),t.eErrorCanvas.tmrID=isc.Timer.setTimeout((function(){e.moveTo(-100,-100)}),3e3),e.bringToFront(),e.show()}}}},hideError:function(){if("Striking"==this.IsMustBehavior){var t=this.items[0];if(t.getError()&&null==t.eErrorCanvas)this.showError.apply(this,arguments);else{var e=t.eErrorCanvas;e&&e.moveTo(-100,-100)}}},useFormat:function(){this.DisplayFormat&&this.DisplayFormat.displayFormat&&(this.items.last().formatEditorValue=this.fireEvent(this,"formatDisplayValue"))},getDefaultMustTipWidth:function(){return 122},setEnabled:function(t){this.Enabled=this.items[0].Enabled=t,this.setDisabled(!t)},setItemEnabled:function(t){this.Enabled=this.items[0].Enabled=t,this.items[0].setDisabled(!t)},setItemReadOnly:function(t){!1!==this.canEditReadOnly&&(this.ReadOnly=this.items[0].ReadOnly=t,this.canEdit=!t,this.items[0].setCanEdit(!t))},setVisible:function(t){this.Visible=this.items[0].Visible=t,t?(this.show(),this.items[0].show()):(this.hide(),this.items[0].hide())},getEnabled:function(){return this.isEnabled()},toFontStyle:function(t,e){if(""==t.toString())return"";try{""!=(t=JSON.parse(t)).Size&&(this[e+"FontStyleSize"]=this.items[0][e+"FontStyleSize"]=parseInt(t.Size)+"px"),""!=t.Family.toString()&&(this[e+"FontStyleFamily"]=this.items[0][e+"FontStyleFamily"]=t.Family.toString());var i="";"true"==t.Underline.toString().toLocaleLowerCase()&&(i+="underline"),"true"==t.Strikeout.toString().toLocaleLowerCase()&&(i+=" line-through"),this[e+"FontStyleDecoration"]=this.items[0][e+"FontStyleDecoration"]=""!=i?i:"none","true"==t.Bold.toString().toLocaleLowerCase()?this[e+"FontStyleBold"]=this.items[0][e+"FontStyleBold"]="bold":this[e+"FontStyleBold"]=this.items[0][e+"FontStyleBold"]="normal ","true"==t.Italic.toString().toLocaleLowerCase()?this[e+"FontStyleItalic"]=this.items[0][e+"FontStyleItalic"]="italic":this[e+"FontStyleItalic"]=this.items[0][e+"FontStyleItalic"]="normal"}catch(t){}},getLabelFontStyle:function(){return this.LabelFontStyle},getLabelForeColor:function(){return this.LabelForeColor},getLabelBackColor:function(){return this.LabelBackColor},getValueFontStyle:function(){return this.ValueFontStyle},setValueFontStyle:function(t){this.ValueFontStyle=JSON.stringify(isc.JGStyleTools.toFontStyle(t));var e=this.toFontStyle(t,"Value");this.items[0].initStyle(),""!==e&&this.redraw()},setValueForeColor:function(t){this.ValueForeColor=this.items[0].ValueForeColor=isc.JGStyleTools.toColor(t),this.items[0].initStyle(),this.redraw()},setValueBackColor:function(t){this.ValueBackColor=this.items[0].ValueBackColor=isc.JGStyleTools.toColor(t),this.items[0].initStyle(),this.redraw()},setLabelFontStyle:function(t){this.LabelFontStyle=JSON.stringify(isc.JGStyleTools.toFontStyle(t)),""!==this.toFontStyle(t,"Label")&&this.items[0].showTitle&&this.redraw()},setLabelForeColor:function(t){this.LabelForeColor=t,this.items[0].LabelForeColor=isc.JGStyleTools.toColor(t),this.items[0].showTitle&&this.redraw()},setLabelBackColor:function(t){this.LabelBackColor=t,this.items[0].LabelBackColor=isc.JGStyleTools.toColor(t),this.items[0].showTitle&&this.redraw()},getSimpleChineseTitle:function(){return this.SimpleChineseTitle},setSimpleChineseTitle:function(t){this.SimpleChineseTitle=t,this.items[0].showTitle&&(this.items[0].title=t,this.redraw())},resized:function(t,e){this.Super("resized",arguments),"None"!=this.Dock&&this.isDrawn()&&("Left"!==this.Dock&&"Right"!==this.Dock&&"Fill"!==this.Dock||(this.setHeight("100%"),this.getItems()[0].setHeight("100%")),"Top"!=this.Dock&&"Bottom"!=this.Dock&&"Fill"!=this.Dock||this.setWidth("100%"))},_addMethods:function(t,e){for(var i in e)t[i]=e[i]},fireEvent:function(t){var e=this.listener[t];if(e&&e.length>0){for(var i=[],s=1,n=arguments.length;s<n;s++)i.push(arguments[s]);for(var r=0,a=e.length;r<a;r++){var o=e[r];o.apply(this,i)}}},getId:function(){return this.widgetId},destroy:function(){this.mouseOver=null,this.listener=null,this._Layout=null,isc.JGWidgetManager.destroy(this.id);var t=this.childrenWidgets;t&&(this.childrenWidgets=null),this.Super("destroy",arguments)},getProperty:function(t){var e=this["get"+t];if("function"==typeof e||"function"==typeof(e=this["is"+t])){for(var i=[],s=1,n=arguments.length;s<n;s++)i.push(arguments[s]);return e.apply(this,i)}},setProperty:function(t,e){var i=this["set"+t];if("function"==typeof i){for(var s=[],n=1,r=arguments.length;n<r;n++)s.push(arguments[n]);return i.apply(this,s)}throw Error(this.getClassName()+"不存在["+t+"]属性!")},isEnabled:function(){return this.Enabled},setHandleReadOnly:function(t){this.setCanEdit&&this.setCanEdit(!t);for(var e=0,i=this.items.length;e<i;e++)this.items[e].setReadonly&&this.items[e].setReadonly(t),this.items[e].setCanEdit(!t),this.items[e].redraw()},setTableName:function(t){this.TableName=t},getTableName:function(){return this.TableName},getDock:function(){return this.Dock},setDock:function(t){this.Dock=t},getLayoutType:function(){return this.LayoutType},setLayoutType:function(t){this.LayoutType=t},getPercentWidth:function(){return this.PercentWidth},setPercentWidth:function(t){this.setWidth(t)},getPercentHeight:function(){return this.PercentHeight},setPercentHeight:function(t){},getStaticLayoutSize:function(){return this.StaticLayoutSize},setStaticLayoutSize:function(t){this.StaticLayoutSize=t},addWidgets:function(t,e){t.childrenWidgets||(t.childrenWidgets=[]),t.childrenWidgets.add(e),e.parentWidget=t},parentReadOnly:function(t,e){if(this.canEditReadOnly=e,this.setHandleReadOnly){this._ReadOnly=t;var i=this.ReadOnly||t;this.setHandleReadOnly(i)}this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",t,e)},isReadOnly:function(){return this._ReadOnly||this.ReadOnly},setReadOnly:function(t){if(isc.isA.Boolean(t)&&this.isReadOnly()!=t)if(1==t){if(this.isReadOnly())return void(this.ReadOnly=t);this.setHandleReadOnly&&this.setHandleReadOnly(t),this._ReadOnly=t,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",t),this.ReadOnly=t}else{if(!this.isReadOnly())return;if(this.parentWidget&&this.parentWidget.isReadOnly()||0==this.canEditReadOnly)return void(this.ReadOnly=t);this.setHandleReadOnly&&this.setHandleReadOnly(t),this._ReadOnly=t,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",t),this.ReadOnly=t}},parentDisabled:function(t){this.disabled||(this._disabled=t,this.setHandleDisabled&&this.setHandleDisabled(t),this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentDisabled",t))},isDisabled:function(){for(var t=this;t;){if(t._disabled||t.disabled)return!0;(t=t.parentElement)&&t.eventProxy&&(t=t.eventProxy)}return!1},getPrintTagStartAttributes:function(t){return t?" style='position:absolute;left:"+this.getLeft()+"px;top:"+this.getTop()+"px;width:"+this.getWidth()+"px;height:"+this.getHeight()+"px;' ":this.printChildrenAbsolutelyPositioned?" style='position:relative;width:"+this.getScrollWidth()+"px;height:"+this.getScrollHeight()+"px;' ":null},controlPrintPreview:function(t){isc.Page&&(isc.Page.getScrollTop()>0||isc.Page.getScrollLeft()>0)&&isc.Page.scrollTo(0,0),isc.Canvas.showPrintPreview(t)},controlPrint:function(t){isc.Canvas.printComponents(t)},setControlFocus:function(){this.focus()},getFieldEvent:function(){return this._fieldEvent},setScopeId:function(t){this.scopeId=t},getScopeId:function(){return this.scopeId},setComponentId:function(t){this.componentId=t},getComponentId:function(){if(this.componentId)return this.componentId;if(this.scopeId){var t=this.scopeId.lastIndexOf("_"),e=this.scopeId.substring(t+1,this.scopeId.length);return this.componentId=e,e}return null},show:function(){!0===this._needToBuildRelation&&this.buildRelation(),this.Super("show",arguments)},getCanvasWidget:function(){},buildRelation:function(){if(this.getVisible()){var t=this.getComponentId(),e=isc.JGComponent.getComponentIndex(t),i=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);if(i&&i.length>0){var s=this.getProperty("LayoutType");if(s&&"BorderLayout"==s){for(var n=0,r=0,a=0,o=0,l=0,h=0,d=0,g=0,c=0;F=i[c];c++){var u=isc.WidgetUtils.genWidgetRefId(this.scopeId,F);if(P=isc.JGWidgetManager.getWidget(u)){var f=P.getProperty("Dock"),p=P.getProperty("PercentWidth"),m=P.getProperty("PercentHeight"),y=P.getProperty("Width"),v=P.getProperty("Height"),b=P.getProperty("StaticLayoutSize");switch(f){case"Top":var S=this._Layout.getMember("Top_"+isc.WidgetUtils.genLayoutId(this.scopeId,this.getId()));P.setPercentWidth("100%"),b||P.setPercentHeight("100%"),S.addMember(P),n+=parseFloat(m),l+=v,b?S.setHeight(l):S.setHeight(n+"%");break;case"Bottom":var I=this._Layout.getMember("Bottom_"+isc.WidgetUtils.genLayoutId(this.scopeId,this.getId()));P.setPercentWidth("100%"),b||P.setPercentHeight("100%"),I.addMember(P),r+=parseFloat(m),h+=v,b?I.setHeight(h):I.setHeight(r+"%");break;case"Left":var C=(L=this._Layout.getMember("Middle_"+isc.WidgetUtils.genLayoutId(this.scopeId,this.getId()))).getMember("Left_"+isc.WidgetUtils.genLayoutId(this.scopeId,this.getId()));b||P.setPercentWidth("100%"),P.setPercentHeight("100%"),C.addMember(P),a+=parseFloat(p),d+=y,b?C.setWidth(d):C.setWidth(a+"%"),L.setHeight(m);break;case"Right":var T=(L=this._Layout.getMember("Middle_"+isc.WidgetUtils.genLayoutId(this.scopeId,this.getId()))).getMember("Right_"+isc.WidgetUtils.genLayoutId(this.scopeId,this.getId()));b||P.setPercentWidth("100%"),P.setPercentHeight("100%"),T.addMember(P),o+=parseFloat(p),g+=y,b?T.setWidth(g):T.setWidth(o+"%"),L.setHeight(m);break;case"Fill":var W=(L=this._Layout.getMember("Middle_"+isc.WidgetUtils.genLayoutId(this.scopeId,this.getId()))).getMember("Center_"+isc.WidgetUtils.genLayoutId(this.scopeId,this.getId()));P.setPercentWidth("100%"),P.setPercentHeight("100%"),W.addMember(P),W.setWidth(p),L.setHeight(m);break;default:this.addChild(P)}P.setIndexPreJoinComponentIndex&&P.setIndexPreJoinComponentIndex(e),P.buildRelation(),this.addWidgets(this,P),(this.ReadOnly||this.isReadOnly())&&P.parentReadOnly(!0),(0==this.Enabled||this.isDisabled())&&P.parentDisabled(!0)}}var L;0==(L=this._Layout.getMember("Middle_"+isc.WidgetUtils.genLayoutId(this.scopeId,this.getId()))).getHeight()&&L.setHeight(100-n-r+"%"),0==(W=L.getMember("Center_"+isc.WidgetUtils.genLayoutId(this.scopeId,this.getId()))).getWidth()&&W.setWidth(100-a-o+"%")}else{var F;for(c=0;F=i[c];c++){var P;u=isc.WidgetUtils.genWidgetRefId(this.scopeId,F);(P=isc.JGWidgetManager.getWidget(u))&&(this.addChild(P),(this.ReadOnly||this.isReadOnly())&&P.parentReadOnly(!0),(0==this.Enabled||this.isDisabled())&&P.parentDisabled(!0),P.setIndexPreJoinComponentIndex&&P.setIndexPreJoinComponentIndex(e),this.addWidgets(this,P),P.buildRelation())}this._needToBuildRelation=!1}}}else this._needToBuildRelation=!0},revert:function(t){if(this.listener)for(var e in this.listener)this.listener[e]=[];if(!1!==t){var i=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);if(i&&i.length>0)for(var s,n=0;s=i[n];n++){var r=isc.WidgetUtils.genWidgetRefId(this.scopeId,s),a=isc.JGWidgetManager.getWidget(r);a&&(a.revert&&a.revert())}}},un:function(t,e){if(t&&e&&e.length>0)for(var i=0,s=e.length;i<s;i++){t[e[i]]=null}},getOrginalRect:function(){return this._orginalRect},isInLayoutWidget:function(){return"JGGroupPanel"==this.getParentType(this)},getParentType:function(t){var e=t.parentElement;if(e){var i=e.type;i||(i=t.getParentType(t.parentElement))}return i},getHorizontalAlign:function(){return this.HorizontalAlign},getVerticalAlign:function(){return this.VerticalAlign},showHighlight:function(){var t=this.styleName;(t||-1==t.indexOf(" v3ComponentHighlight"))&&(t=t?t+" v3ComponentHighlight":"v3ComponentHighlight",this.setStyleName(t))},hideHighlight:function(){var t=this.styleName;t&&-1!=t.indexOf(" v3ComponentHighlight")&&(t=t.replace(" v3ComponentHighlight",""),this.setStyleName(t))},mapping:function(t,e,i,s){0!=t.length&&t.forEach((function(t){t[e]&&t[e](i,s)}))},validateWidget:function(){if(!1===this.Visible)return!0;var t=!0,e=this.scopeId,i=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);return this.validate&&"function"==typeof this.validate?t=this.validate():i&&$.each(i,(function(i,s){var n=isc.WidgetUtils.genWidgetRefId(e,s),r=isc.JGWidgetManager.getWidget(n);r.validateWidget&&!r.validateWidget()&&(t=!1)})),t},itemChanged:function(t,e){this.notifyParentValidateChanged()},notifyParentValidateChanged:function(){for(var t=this.parentElement;t;)t.onChildValidateResultChanged&&t.onChildValidateResultChanged(!0),t=t.parentElement},_getVM:function(){var t=this.TableName,e=isc.JGV3ValuesManager.genId(t.ID,this.scopeId,this.code);return isc.JGV3ValuesManager.getById(e,t)},getBindFields:function(){return[this.ColumnName]},_filterData:function(t,e){var i={};if(e){for(var s=0,n=t.length;s<n;s++){var r=t[s];i[r]=e[r]}i.id=e.id}return i},setWidgetData:function(t,e){var i=this._getVM(),s=this.getBindFields();i.setFieldCodes&&i.setFieldCodes([].concat(s));var n=i.getValues(),r={};for(var a in n&&Object.assign(r,n),r)r.hasOwnProperty(a)&&"id"!=a&&-1==s.indexOf(a)&&delete r[a];var o=this._filterData(s,e);for(var a in o)o.hasOwnProperty(a)&&(r[a]=o[a]);i.editRecord(r)},clearWidgetData:function(){this._getVM().clearValues()},getWidgetData:function(){var t=this._getVM().getValues(),e=this.getBindFields();if(1==e.length)return t[e[0]];for(var i={},s=0,n=e.length;s<n;s++){var r=e[s];i[r]=t[r]}return i},setV3Value:function(t){var e=this.TableName;if(e){var i=this.getBindFields(),s=e.getCurrentRecord(),n={};if(s||(s=e.createRecord(),e.insertRecords([s])),n.id=s.id,1==i.length)n[i[0]]=t;else if(i.length>1)for(var r=0,a=i.length;r<a;r++){var o=i[r];n[o]=t[o]}e.updateRecords([n])}},clearWidgetBindDatas:function(t){var e=this.TableName;if(e){var i=this.getBindFields(),s=t?e.getSelectedRecords():e.getAllRecords(),n=[];if(i&&i.length>0&&s&&s.length>0)for(var r=0,a=s.length;r<a;r++){for(var o={id:s[r].id},l=0,h=i.length;l<h;l++)o[i[l]]=null;n.push(o)}n.length>0&&e.updateRecords(n)}},getDefaultValue:function(){return this.DefaultValue},getV3Value:function(){var t=this.getWidgetData();return null==t||null==t?"":t},getVisible:function(){return this.isVisible()},getReadOnly:function(){return this.isReadOnly()},setLabelText:function(t){this.setSimpleChineseTitle(t)},getLabelText:function(){return this.getSimpleChineseTitle()},cleanSelectedControlValue:function(t){this.clearWidgetBindDatas(t)},setV3Focus:function(){this.setControlFocus()},getV3MethodMap:function(){return{setValue:"setV3Value",getValue:"getV3Value",setFocus:"setV3Focus"}}})}));
