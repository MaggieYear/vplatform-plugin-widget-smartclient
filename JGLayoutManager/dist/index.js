!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";isc.ClassFactory.defineInterface("JGLayoutManager"),isc.JGLayoutManager.addInterfaceProperties({_Layout:null}),isc.JGLayoutManager.addInterfaceMethods({_processRect:function(t,e){if("Fill"==this.Dock)return"100%";if("string"==typeof t){if("content"==t)return null;if("space"==t)return"100%";if(t.endsWith("%"))return t;if(t.endsWith("px"))return parseInt(t)}return t},_forEach:function(t,e,i,a){if(t&&t.length>0)for(var s=i=i||0,o=t.length;s<o&&!1!==e.call(a,t[s],s,t);s++);},layoutChildWidgets:function(t){var e,i=[];if(this.isOldWindowLayoutConfig&&this.isOldWindowLayoutConfig())if("BorderLayout"==this.LayoutType){var a=this.createLayoutById(this.scopeId+"_"+this.Code);e=this.buildBorderLayoutById(a),i.push(a),this._resetAbsWidgetPlace(e.absLayout),(r=this._layoutAbsoluteChildren(e))&&(i=i.concat(r))}else i=this._getChildrenWidget(t);else{var s=!0;if("BorderLayout"==this.LayoutType){window.console&&window.console.warn("当前窗体是新布局窗体，还存在BorderLayout");a=this.createLayoutById(this.scopeId+"_"+this.Code);e=this.buildBorderLayoutById(a),i.push(a)}else{e=this._catalogChildren(t);var o=this._getChildrenLayoutDirection(e);if(this._setDockChildRect(e),"horizontal"==o){a=this._createHorizontalLayoutByCatalog(e);i.push(a)}else if("vertical"==o){a=this._createVerticalLayoutByCatalog(e);i.push(a)}if("JGGroupPanel"==this.type&&"Vertical"==this.ContentAlignment){var r,n=[];(r=this._layoutAbsoluteChildren(e))&&r.length>0&&(s=!1,n=this.analyzeVLayoutChild(r,!0),i=i.concat(n))}}if(s)(r=this._layoutAbsoluteChildren(e))&&(i=i.concat(r))}return i},_resetAbsWidgetPlace:function(t){if(t&&!(t.length<1))for(var e=0,i=t.length;e<i;e++){var a=t[e],s=a.getOrginalRect();a.setWidth(s[0]),a.setHeight(s[1])}},_getChildrenWidget:function(t){var e=[];t=t||this.widgetId;this.scopeId;var i=isc.WidgetContext.getChildrenIds(this.scopeId,t);return this._forEach(i,(function(t,i){var a=isc.WidgetUtils.genWidgetRefId(this.scopeId,t),s=isc.JGWidgetManager.getWidget(a);if(s){var o=s.getOrginalRect();s.setWidth(o[0]),s.setHeight(o[1]),e.push(s),this.addWidgets&&this.addWidgets(this,s),(this.ReadOnly||this.isReadOnly&&this.isReadOnly())&&s.parentReadOnly&&s.parentReadOnly(!0),(0==this.Enabled||this.isDisabled&&this.isDisabled())&&s.parentDisabled&&s.parentDisabled(!0)}}),0,this),e},_catalogChildren:function(t,e){t=t||this.widgetId;var i=isc.WidgetContext.getChildrenIds(this.scopeId,t),a={};return this._forEach(i,(function(t,i){var s=isc.WidgetUtils.genWidgetRefId(this.scopeId,t),o=isc.JGWidgetManager.getWidget(s);if(o)switch(this.getChildDock(o)){case"Top":if(e)e.members[0].addMember(o);else{var r=a.vLayout||[];a.vLayout=r,r.push(o)}break;case"Bottom":if(e)e.members[2].addMember(o);else{r=a.vLayout||[];a.vLayout=r,r.push(o)}break;case"Left":if(e)e.members[1].members[0].addMember(o);else{r=a.hLayout||[];a.hLayout=r,r.push(o)}break;case"Right":if(e)e.members[1].members[2].addMember(o);else{r=a.hLayout||[];a.hLayout=r,r.push(o)}break;case"Fill":e?e.members[1].members[1].addMember(o):a.fill=o;break;default:r=a.absLayout||[];a.absLayout=r,r.push(o)}}),0,this),a},getChildDock:function(t){return t&&t.getProperty?t.getProperty("Dock"):"None"},_getChildrenLayoutDirection:function(t){var e=t.vLayout,i=t.hLayout,a=t.fill,s=e&&e.length>0,o=i&&i.length>0,r=a&&a.length>0;if(s&&!o)return"vertical";if((o||r)&&!s)return"horizontal";var n=this.getOrginalRect();this.isOldWindowLayoutConfig&&this.isOldWindowLayoutConfig()?(n[0]=n[0]-this.LayoutLeftMargin-this.LayoutRightMargin,n[1]=n[1]-this.LayoutTopMargin-this.LayoutBottomMargin):"function"==typeof this._getChildRect&&(n=this._getChildRect());var c=null;return this._forEach(t.vLayout,(function(t){var e=t.Dock;if("Top"==e&&this._isFullDockTop(t,n)||"Bottom"==e&&this._isFullDockBottom(t,n))return c="vertical",!1}),0,this),null==c&&this._forEach(t.hLayout,(function(t){var e=t.Dock;if("Left"==e&&this._isFullDockLeft(t,n)||"Right"==e&&this._isFullDockRight(t,n))return c="horizontal",!1}),0,this),null==c&&(c=t.fill?t.vLayout?"vertical":"horizontal":"absolute"),c},_setDockChildRect:function(t){this._forEach(t.hLayout,(function(t){this._setHorizontalDockChildRect(t)}),0,this),this._forEach(t.vLayout,(function(t){this._setVerticalDockChildRect(t)}),0,this);var e=t.fill;e&&(e.setPercentWidth("100%"),e.setPercentHeight("100%"))},_layoutAbsoluteChildren:function(t){var e=t.absLayout,i=this.getContentAlignment();if("Vertical"==i){var a=[],s=[],o=[];this._sortByVertical(e),this._forEach(e,(function(t){switch(t&&t.getVerticalAlign?t.getVerticalAlign():"Top"){case"Top":a.push(t);break;case"Middle":s.push(t);break;case"Bottom":o.push(t)}t.layoutAlign=this._getHorizontalAlign(t)}),0,this),e=this._fillAbsoulteLayoutSpacer(a,s,o)}else if("Horizontal"==i){var r=[],n=[],c=[];this._sortByHorizontal(e),this._forEach(e,(function(t){switch(t&&t.getHorizontalAlign?t.getHorizontalAlign():"Left"){case"Left":r.push(t);break;case"Center":n.push(t);break;case"Right":c.push(t)}t.layoutAlign=this._getVerticalAlign(t)}),0,this),e=this._fillAbsoulteLayoutSpacer(r,n,c)}else"Table"==i&&(e.sort((function(t,e){var i=t.Top-e.Top;return 0!=i?i:t.Left-e.Left})),this._forEach(e,(function(t){t.setPercentWidth("100%")}),0,this));return e},_getVerticalAlign:function(t){var e=t&&t.getVerticalAlign?t.getVerticalAlign().toLowerCase():"top";return"middle"==e?"center":e},_getHorizontalAlign:function(t){return t&&t.getHorizontalAlign?t.getHorizontalAlign().toLowerCase():"left"},_createHorizontalLayoutByCatalog:function(t){var e,i,a=t.vLayout,s=t.hLayout,o=t.fill;if(this._sortByHorizontal(s),a&&a.length>0){var r=a[0].Left;this._sortByVertical(a),this._fillVerticalDockSpacer(a,o);var n=isc.VLayout.create({membersMargin:8,members:a}),c=-1;this._forEach(s,(function(t,e){var i=t.Left;if(r<i)return c=e,!1}),0,this),c=-1==c?s.length:c,s.splice(c,0,n)}else s=this._fillHorizontalDockSpacer(s,o);switch(this.Dock){case"Left":case"Right":e=this.MultiWidth.endsWith("%")?"100%":this._processRect(this.MultiWidth,"width"),i="100%";break;case"Top":case"Bottom":e="100%",i="100%";break;default:if("function"==typeof this._getChildRect){var h=this._getChildRect(this.getOrginalRect());e=this._processRect(h[0],"width"),i=this._processRect(h[1],"height")}else e=this._processRect(this.MultiWidth,"width"),i=this._processRect(this.MultiHeight,"height")}var l={defaultWidth:5,defaultHeight:5,membersMargin:"function"==typeof this.getMembersMargin?this.getMembersMargin():8,layoutMargin:"function"==typeof this.getLayoutMargin?this.getLayoutMargin():8,canFocus:!0,width:e,height:"Left"==this.Dock||"Right"==this.Dock?"100%":i,overflow:isc.Canvas.VISIBLE,members:s};return"function"==typeof this.resetLayoutMargin&&this.resetLayoutMargin(l),isc.HLayout.create(l)},_createVerticalLayoutByCatalog:function(t){var e="function"==typeof this.getMembersMargin?this.getMembersMargin():8,i="function"==typeof this.getLayoutMargin?this.getLayoutMargin():8,a=t.vLayout,s=t.hLayout,o=t.fill;if(this._sortByVertical(a),s&&s.length>0){var r=s[0].Top;this._sortByHorizontal(s),this._fillHorizontalDockSpacer(s,o);var n=isc.HLayout.create({membersMargin:e,members:s}),c=-1;this._forEach(a,(function(t,e){var i=t.Top;if(r<i)return c=e,!1}),0,this),c=-1==c?a.length:c,a.splice(c,0,n)}else this._fillVerticalDockSpacer(a,o);var h=scopeManager.getWindowScope();if(null!=h&&"vbase_prd_workflow"==h.getComponentCode()&&"PrdWorkFlowBizTableProcessOperate"==h.getWindowCode()){var l=isc.Canvas.create({width:"100%",height:1,top:"8px",className:"VSpecialLayout",contents:""});a.splice(1,0,l)}var u=this.MultiWidth;if("function"==typeof this._getChildRect&&u&&"space"!=u&&"content"!=u&&-1==u.indexOf("%"))try{var d=parseInt(u);u=isNaN(d)?this._processRect(u,"width"):this._getChildRect()[0]}catch(t){u=this._processRect(u,"width")}else u=this._processRect(u,"width");var g={defaultWidth:5,defaultHeight:5,membersMargin:e,layoutMargin:i,canFocus:!0,width:"Top"==this.Dock||"Bottom"==this.Dock?"100%":u,height:"JGTabControl"==this.getClassName()?"100%":this._processRect(this.MultiHeight,"height"),overflow:isc.Canvas.VISIBLE,members:a};return"function"==typeof this.resetLayoutMargin&&this.resetLayoutMargin(g),g.members=this.analyzeVLayoutChild(a),isc.VLayout.create(g)},analyzeVLayoutChild:function(t,e){if(!t||0==t.length)return t;for(var i=[],a=null,s=function(t){for(var e=this.Super("sectionIsExpanded",arguments),i=t.items,a=0,s=i.length;a<s;a++){var o=i[a];if(o.getContentElement&&o.getContentElement()&&o.getContentElement().parentElement&&o.getContentElement().parentElement.style){var r=o.getContentElement().parentElement.style,n="SectionStack"===window[$(o.getContentElement().parentElement).attr("eventproxy")].getClassName();e&&!n?(o._$sourceDisplay=r.display,r.display="none"):r.display=o._$sourceDisplay||""}}return e},o=function(t,e){this.Super("expandSection",arguments);for(var i=t.items,a=0,s=i.length;a<s;a++)!1===i[a].Visible&&i[a].hide()},r=function(t){var e=this.children;e&&e.callMethod("parentReadOnly",t)},n=function(t){var e=t.getSections();return e||(e=[]),e},c=function(t,e){var i=n(t);for(j=0,_sLen=i.length;j<_sLen;j++){var a=i[j],s=t.getSection(a);if(s){var o=s._$widgetCode;o&&e[o]&&e[o].setSectionStackInfo&&e[o].setSectionStackInfo({show:function(t,e){return function(){t.isVisible()||t.show(),t.showSection(e)}}(t,a),hide:function(t,e){return function(){t.hideSection(e);for(var i=n(t),a=!0,s=0,o=i.length;s<o;s++){var r=t.getSection(i[s]);r&&r.isVisible()&&(a=!1)}a&&t.hide()}}(t,a)})}}},h={},l=0,u=t.length;l<u;l++){var d=t[l],g=d.widgetId;if(h[g]=d,"function"==typeof d.isAssignLayout&&d.isAssignLayout()){null==a&&(a=[]);var f=d.buildSectionStackItem()||{};f._$widgetCode=g,a.push(f);var y={visibilityMode:"multiple",width:"100%",membersMargin:8,defaultHeight:5,vPolicy:"none",height:16,overflow:"visible",sectionIsExpanded:s,sections:a,expandSection:o,type:"JGSectionStack",parentReadOnly:r},p=d.MultiHeight;if(e&&"fill"==this.Dock||"100%"==p||"space"==p){y.vPolicy="fill",y.overflow="auto";try{delete y.height,delete y.defaultHeight}catch(t){}}else p.endsWith("%")?(y.vPolicy="fill",y.height=p):(p=parseInt(p))&&!isNaN(p)&&(y.height=p);c(L=isc.SectionStack.create(y),h),i.push(L),a=null}else{if(null!=a){y={visibilityMode:"multiple",width:"100%",membersMargin:8,defaultHeight:5,vPolicy:"none",height:16,overflow:"visible",sectionIsExpanded:s,sections:a,expandSection:o,type:"JGSectionStack",parentReadOnly:r};if(e&&"fill"==this.Dock){y.vPolicy="fill",y.overflow="auto";try{delete y.height,delete y.defaultHeight}catch(t){}}c(L=isc.SectionStack.create(y),h),i.push(L),a=null}i.push(d)}}if(null!=a){var L;y={visibilityMode:"multiple",width:"100%",membersMargin:8,defaultHeight:5,vPolicy:"none",height:16,overflow:"visible",sectionIsExpanded:s,sections:a,expandSection:o,type:"JGSectionStack",parentReadOnly:r};if(e&&"fill"==this.Dock){y.vPolicy="fill",y.overflow="auto";try{delete y.height,delete y.defaultHeight}catch(t){}}c(L=isc.SectionStack.create(y),h),i.push(L),a=null}return i},_getDiffDockIndexInfo:function(t){var e=-1,i=null,a=this;return this._forEach(t,(function(t,s){var o=a.getChildDock(t);if(null!=i&&i!=o)return e=s,!1;i=o}),0,this),{index:e,dock:i}},_hasPercentChild:function(t,e){var i=!1;return this._forEach(t,(function(t){var a=t[e];if("string"==typeof a&&a.endsWith("%"))return i=!0,!1})),i},_fillHorizontalDockSpacer:function(t,e){if(t&&t.length>0){var i=this._getDiffDockIndexInfo(t),a=i.index,s=i.dock;if(-1==a)if("Left"==s)e?t.push(e):this._hasPercentChild(t,"MultiWidth")&&t.push(isc.LayoutSpacer.create({}));else{var o=e||isc.LayoutSpacer.create({});t.splice(0,0,o)}else{o=e||isc.LayoutSpacer.create({});t.splice(a,0,o)}return t}if(e)return[e]},_fillVerticalDockSpacer:function(t,e){var i=this._getDiffDockIndexInfo(t),a=i.index,s=i.dock;if(-1==a)if("Top"==s)e?t.push(e):this._hasPercentChild(t,"MultiHeight")&&t.push(isc.LayoutSpacer.create({}));else{var o=e||isc.LayoutSpacer.create({});t.splice(0,0,o)}else{o=e||isc.LayoutSpacer.create({});t.splice(a,0,o)}},_fillAbsoulteLayoutSpacer:function(t,e,i){for(var a=[],s=0,o=arguments.length;s<o;s++){(n=arguments[s])&&n.length>0&&(a=a.concat(n)),s+1<o&&a.push(isc.LayoutSpacer.create({}))}var r=[];for(s=0,o=a.length;s<o;s++){var n,c=(n=a[s]).getClassName?n.getClassName():null;for(r.push(n);a[s+1];){var h=a[s+1],l=h&&h.getClassName?h.getClassName():null;if("LayoutSpacer"!=c||"LayoutSpacer"!=l)break;s++}}return r},_setVerticalDockChildRect:function(t){t.setWidth("100%"),t.setPercentWidth&&t.setPercentWidth("100%");var e=t.MultiHeight;"content"==e||t.setHeight(e)},_setHorizontalDockChildRect:function(t){t.setHeight("100%"),t.setPercentHeight&&t.setPercentHeight("100%");var e=t.MultiWidth;"content"==e||t.setWidth(e)},_sortByHorizontal:function(t){t&&t.length>0&&t.sort((function(t,e){return t.Left-e.Left}))},_sortByVertical:function(t){t&&t.length>0&&t.sort((function(t,e){return t.Top-e.Top}))},_isChildrenFullHorizontal:function(t,e){var i=!0;return this._forEach(t,(function(t){if(!this._isFullDockRight(t,e))return i=!1,!1}),0,this),i},_isChildrenFullVertical:function(t,e){var i=!0;return this._forEach(t,(function(t){if(!this._isFullDockBottom(t,e))return i=!1,!1}),0,this),i},_isFullDockLeft:function(t,e){return this._isFullDockRight(t,e)},_isFullDockRight:function(t,e){return t.getOrginalRect()[1]==e[1]},_isFullDockTop:function(t,e){return this._isFullDockBottom(t,e)},_isFullDockBottom:function(t,e){return t.getOrginalRect()[0]==e[0]},initLayout:function(){this.LayoutType&&"BorderLayout"==this.LayoutType&&(this._Layout=this.createLayoutById(isc.WidgetUtils.genLayoutId(this.scopeId,this.getId())))},buildBorderLayoutById:function(t){var e={},i=0,a=0,s=0,o=0,r=0,n=0,c=0,h=0,l=isc.WidgetUtils.genLayoutId(this.scopeId,this.Code),u=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);if(u&&u.length>0)for(var d,g=0;d=u[g];g++){var f=isc.WidgetUtils.genWidgetRefId(this.scopeId,d),y=isc.JGWidgetManager.getWidget(f);if(y){this.addWidgets&&this.addWidgets(this,y),(this.ReadOnly||this.isReadOnly&&this.isReadOnly())&&y.parentReadOnly&&y.parentReadOnly(!0),(0==this.Enabled||this.isDisabled&&this.isDisabled())&&y.parentDisabled&&y.parentDisabled(!0);var p,L,v=y.getProperty("Dock"),_=y.getProperty("PercentWidth"),m=y.getProperty("PercentHeight");if(y.getOrginalRect){var b=y.getOrginalRect();p=b[0],L=b[1]}else p=y.getProperty("Width"),L=y.getProperty("Height");var M=y.getProperty("StaticLayoutSize");switch(v){case"Top":var C=t.getMember("Top_"+l);y.setPercentWidth("100%"),M||y.setPercentHeight("100%"),C.addMember(y),i+=parseFloat(m),r+=L,M?C.setHeight(r):C.setHeight(i+"%");break;case"Bottom":var k=t.getMember("Bottom_"+l);y.setPercentWidth("100%"),M||y.setPercentHeight("100%"),k.addMember(y),a+=parseFloat(m),n+=L,k.setHeight(n),M?k.setHeight(n):k.setHeight(a+"%");break;case"Left":var D=(w=t.getMember("Middle_"+l)).getMember("Left_"+l);M||y.setPercentWidth("100%"),y.setPercentHeight("100%"),D.addMember(y),s+=parseFloat(_),c+=p,M?D.setWidth(c):D.setWidth(s+"%"),w.setHeight(m);break;case"Right":var W=(w=t.getMember("Middle_"+l)).getMember("Right_"+l);M||y.setPercentWidth("100%"),y.setPercentHeight("100%"),W.addMember(y),o+=parseFloat(_),h+=p,M?W.setWidth(h):W.setWidth(o+"%"),w.setHeight(m);break;case"Fill":var w,H=(w=t.getMember("Middle_"+l)).getMember("Center_"+l);y.setPercentWidth("100%"),y.setPercentHeight("100%"),H.addMember(y),H.setWidth(_),w.setHeight(m);break;default:var I=e.absLayout||[];e.absLayout=I,I.push(y)}}}return 0==(w=t.getMember("Middle_"+l)).getHeight()&&w.setHeight(100-i-a+"%"),0==(H=w.getMember("Center_"+l)).getWidth()&&H.setWidth(100-s-o+"%"),e},createLayoutById:function(t){return isc.VLayout.create({autoDraw:!1,ID:"Layout_"+t,width:"100%",height:"100%",layoutLeftMargin:this.LayoutLeftMargin,layoutTopMargin:this.LayoutTopMargin,layoutRightMargin:this.LayoutRightMargin,layoutBottomMargin:this.LayoutBottomMargin,contents:"",canFocus:!0,members:[isc.VLayout.create({autoDraw:!1,ID:"Top_"+t,height:0,contents:"",canFocus:!0,members:[]}),isc.HLayout.create({autoDraw:!1,ID:"Middle_"+t,height:0,contents:"",canFocus:!0,members:[isc.HLayout.create({autoDraw:!1,ID:"Left_"+t,width:0,contents:"",canFocus:!0,members:[]}),isc.HLayout.create({autoDraw:!1,ID:"Center_"+t,width:0,contents:"",canFocus:!0,members:[]}),isc.HLayout.create({autoDraw:!1,ID:"Right_"+t,width:0,contents:"",canFocus:!0,members:[]})]}),isc.VLayout.create({autoDraw:!1,ID:"Bottom_"+t,zIndex:100002,overflow:isc.Canvas.HIDDEN,height:0,canFocus:!0,contents:"",members:[]})]})}})}));
