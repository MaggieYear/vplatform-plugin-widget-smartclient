!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";isc.ClassFactory.defineInterface("IV3BaseWidget"),isc.IV3BaseWidget.addInterfaceProperties({Top:0,Left:0,Width:null,MultiWidth:null,Height:null,MutiHeight:null,ContentAlignment:null,HorizontalAlign:null,VerticalAlign:null,_orginalRect:null}),isc.IV3BaseWidget.addInterfaceMethods({initV3Widget:function(){this.id=isc.WidgetUtils.genWidgetRefId(this.scopeId,this.widgetId);var t=[this.Width,this.Height];this._orginalRect=t,isc.JGWidgetManager.putWidget(this.id,this)},_processRect:function(t,e){if("string"==typeof t){if("content"==t)return 20;if(t.endsWith("%"))return t;if(t.endsWith("px"))return parseInt(t)}return t},_processContentVal:function(t){return parseInt(.5*t)},getProcessedHeight:function(){return this._processRect(this.MultiHeight,"height")},getProcessedWidth:function(){return this._processRect(this.MultiWidth,"width")},setPercentHeight:function(t){this.setHeight(t)},setPercentWidth:function(t){this.setWidth(t)},getOrginalRect:function(){return this._orginalRect},addV3Child:function(t){this.addChild(t)},buildRelation:function(){var t=this.layoutChildWidgets();if(t&&t.length>0)for(var e=0;s=t[e];e++)this.addV3Child(s);var i=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);if(i&&i.length>0){var n;for(e=0;n=i[e];e++){var s,r=isc.WidgetUtils.genWidgetRefId(this.scopeId,n);(s=isc.JGWidgetManager.getWidget(r))&&s.buildRelation()}}},getContentAlignment:function(){return this.ContentAlignment},getHorizontalAlign:function(){return this.HorizontalAlign},getVerticalAlign:function(){return this.VerticalAlign},parentReadOnly:function(t){"JGGroupPanel"==this.type&&(t&&this.childrenWidgets&&1==this.childrenWidgets.length?(this.realHeight=this.getVisibleHeight(),this.setHeight(0)):"number"==typeof this.realHeight&&this.setHeight(this.realHeight)),this.ReadOnly||(this._ReadOnly=t,this.setHandleReadOnly&&this.setHandleReadOnly(t),this.childrenWidgets&&this.childrenWidgets.map("parentReadOnly",t))},on:function(t,e){if("ConfigChanged"==t&&e(),this.listener||(this.listener=[]),this.listener.hasOwnProperty(t))this.listener[t].push(e);else if("ConfigChanged"!=t)throw Error("控件["+this.getClassName()+"]不支持["+t+"]事件！")},un:function(t){if(this.listener){if(!this.listener.hasOwnProperty(t))throw Error("控件["+this.getClassName()+"]不支持["+t+"]事件！");this.listener[t]=[]}},getLayoutVersion:function(){return this._$windowVersion},isOldWindowLayoutConfig:function(){var t=this.getLayoutVersion();if(null==t||""==t)return!0;var e="number"==typeof this.Width&&-1!=this.MultiWidth.indexOf("px")&&this.MultiWidth!=this.Width+"px",i="number"==typeof this.Height&&-1!=this.MultiHeight.indexOf("px")&&this.MultiHeight!=this.Height+"px";return!(!e||!i)},firePlatformEventBefore:function(t,e,i){},firePlatformEventAfter:function(t,e,i){}}),isc.ClassFactory.defineInterface("IV3RectAdapter"),isc.IV3RectAdapter.addInterfaceMethods({adaptRectByV3:function(){"content"==this.MultiHeight&&this.adaptHeightByV3(),"content"==this.MultiWidth&&this.adaptWidthByV3()},adaptHeightByV3:function(){this.canAdaptHeight=!0,this.adaptHeightBy=function(){return 0}},adaptWidthByV3:function(){this.canAdaptWidth=!0,this.adaptWidthBy=function(){return 0}}}),isc.ClassFactory.defineInterface("IWindowAop"),isc.IWindowAop.addInterfaceMethods({dataLoaded:function(){},windowInited:function(){},beforeDataLoad:function(){}}),isc.ClassFactory.defineClass("JGBaseWidget","Canvas"),isc.ClassFactory.mixInInterface("JGBaseWidget","JGEventManager"),isc.ClassFactory.mixInInterface("JGBaseWidget","JGLayoutManager"),isc.ClassFactory.mixInInterface("JGBaseWidget","IV3BaseWidget"),isc.JGBaseWidget.addClassProperties({_initedHandlers:[]}),isc.JGBaseWidget.addClassMethods({addInitedHandler:function(t){isc.JGBaseWidget._initedHandlers.push(t)}}),isc.JGBaseWidget.addProperties({defaultWidth:5,defaultHeight:5,autoDraw:!1,id:"",widgetId:"",scopeId:null,componentId:null,name:"",_fieldEvent:null,contents:"",TableName:null,SourceTableName:null,MultiHeight:null,MultiWidth:null,Dock:null,LayoutType:null,PercentWidth:null,PercentHeight:null,StaticLayoutSize:!1,hoverWidth:250,canFocus:!0,showFocusOutline:!1,_orginalRect:null,_defaultListener:["mouseOver","mouseLeave","showProtoInfo","moveProtoInfo"],listener:[]}),isc.JGBaseWidget.addMethods({init:function(){this.id=isc.WidgetUtils.genWidgetRefId(this.scopeId,this.widgetId);var t=[this.Width,this.Height];this._orginalRect=t,this._fieldEvent={},this._initCanvas(),this.Super("init",arguments),this._initWidget(arguments),this._initListener(),this._enhanceEvents(),this._afterInitWidget(),this._referPartFunc(),this.mouseOver=this._handleMouseOver,this.mouseLeave=this._referEvent(this,"mouseLeave"),isc.JGWidgetManager.putWidget(this.id,this);for(var e=isc.JGBaseWidget._initedHandlers,i=0,n=e.length;i<n;i++){var s=e[i];s.apply(this)}},_enhanceEvents:function(){var t=this.listener;if(t)for(var e in t)if(t.hasOwnProperty(e)){var i=this[e];"function"==typeof i&&this.listener[e].push(i)}},_handleMouseOver:function(){this.fireEvent("mouseOver");["JGTreeGrid","JGDataGrid","JGTabControl","JGQueryConditionPanel"].filter((function(t){return t===this.WidgetStyle})).length||this.fireEvent("showProtoInfo",null,this.getClipHandle(),[this.Code])},resizeTo:function(){this.Super("resizeTo",arguments),this.fireEvent("moveProtoInfo")},addV3Child:function(t){this.addChild(t)},getOrginalRect:function(){return this._orginalRect},_initCanvas:function(){if(this.left=this.Left,this.top=this.Top,this.isOldWindowLayoutConfig&&this.isOldWindowLayoutConfig())this.LayoutType&&"BorderLayout"!=this.LayoutType||this.Dock&&"Fill"!=this.Dock?(this.width=this.Width,this.height=this.Height):(this.width="100%",this.height="100%");else{var t=(this.Dock+"").toLowerCase();"space"==this.MultiWidth||"top"==t||"bottom"==t||"fill"==t?(this.width="100%",this.Width="100%"):"content"==this.MultiWidth?(this.width=null,this.Width=null):"string"==typeof this.MultiWidth?"0px"==this.MultiHeight?this.height=this.Height:(this.width=this.MultiWidth,this.MultiWidth.endsWith("px")?this.Width=parseInt(this.MultiWidth):this.Width="100%"):this.width="BorderLayout"==this.LayoutType?"100%":this.Width,"space"==this.MultiHeight||"left"==t||"right"==t||"fill"==t?(this.height="100%",this.Height="100%"):"content"==this.MultiHeight?("JGComponentContainer"==this.type&&(this._height=this.Height),this.height=null,this.Height=null):"string"==typeof this.MultiHeight?"0px"==this.MultiHeight?this.height=this.Height:(this.height=this.MultiHeight,this.MultiHeight.endsWith("px")?this.Height=parseInt(this.MultiHeight):this.Height="100%"):this.height="BorderLayout"==this.LayoutType?"100%":this.Height}this.printChildrenAbsolutelyPositioned=!0,isc.isA.Boolean(this.Visible)&&(this.visibility=this.Visible?isc.Canvas.INHERIT:isc.Canvas.HIDDEN)},_initListener:function(){var t={};this.listener=this.listener.concat(this._defaultListener);for(var e=0,i=this.listener.length;e<i;e++)t[this.listener[e]]=[];this.listener=t},_initWidget:function(){},_afterInitWidget:function(){},_referPartFunc:function(){},_addMethods:function(t,e){for(var i in e)t[i]=e[i]},_referFuncs:function(t,e){isc.isAn.Array(e)||(e=[e]);for(var i=0,n=e.length;i<n;i++){var s=e[i];this[s]=this._referFunc(t,s)}},_referFunc:function(t,e){var i=t.ID;return function(){var t=this.getWindow()[i];if(!t)throw Error("不存在["+i+"]对象，请检查！");var n=t[e];if("function"==typeof n){for(var s=[],r=0,a=arguments.length;r<a;r++)s.push(arguments[r]);return n.apply(t,s)}throw Error(t.getClass()+"不存在方法"+e)}},_referEvent:function(t,e){isc.isAn.Array(e)||(e=[e]);var i;t.ID;return i=t,function(){var t=i.ID,n=this.getWindow()[t];if(!n)throw Error("不存在["+t+"]对象，请检查！");if(e&&e.length>0)for(var s=0,r=e.length;s<r;s++){var a=e[s];if("function"==typeof a)a.apply(n,arguments);else if(n.listener){var h=n.listener[a];if(h&&h.length>0)for(var d=0,l=h.length;d<l;d++){var o=h[d];o.apply(n,arguments)}}}return!0}},_referEventTimeout:function(t,e){isc.isAn.Array(e)||(e=[e]);var i=t.ID;return function(){return e&&e.length>0&&setTimeout((function(){var t=window[i];if(!t)throw Error("不存在["+i+"]对象，请检查！");for(var n=0,s=e.length;n<s;n++){var r=e[n];if("function"==typeof r)r.apply(t,arguments);else if(t.listener){var a=t.listener[r];if(a&&a.length>0)for(var h=0,d=a.length;h<d;h++){var l=a[h];l.apply(t,arguments)}}}}),10),!0}},_referTimerEventHandler:function(t,e){isc.isAn.Array(e)||(e=[e]);var i=t.ID;return function(){var t=this.getWindow()[i];if(!t)throw Error("不存在["+i+"]对象，请检查！");if(e&&e.length>0)for(var n=0,s=e.length;n<s;n++){var r=e[n];if("function"==typeof r)r.apply(t,arguments);else{var a=t.listener[r];if(a&&a.length>0)for(var h=0,d=a.length;h<d;h++){var l=a[h];isc.TimerEventHandler.push((function(){var t=window[i];t&&t.pause&&t.pause()})),isc.TimerEventHandler.push((function(){var t=window[i];t&&(l.apply(t,arguments),t.resume&&!t.destroyed&&t.resume())})),isc.TimerEventHandler.run()}}}return!0}},_callEvent:function(t,e){if(isc.isAn.Array(e)||(e=[e]),e&&e.length>0){for(var i=[],n=2,s=arguments.length;n<s;n++)i.push(arguments[n]);for(n=0,s=e.length;n<s;n++){var r=e[n],a=t.listener[r];if(a&&a.length>0)for(var h=0,d=a.length;h<d;h++){var l=a[h];arguments.callee.caller!==l&&l.apply(t,i)}}}return!0},fireEvent:function(t){if(this.listener){var e=this.listener[t];if(e&&e.length>0){for(var i=[],n=2,s=arguments.length;n<s;n++)i.push(arguments[n]);for(var r=0,a=e.length;r<a;r++){var h=e[r];h.apply(this,i)}}}},getId:function(){return this.widgetId},destroy:function(){this.mouseOver=null,this.mouseLeave=null,this.showProtoInfo=null,this.moveProtoInfo=null,this.listener=null,this._Layout=null,isc.JGWidgetManager.destroy(this.id);var t=this.childrenWidgets;t&&(this.childrenWidgets=null),this.Super("destroy",arguments)},getProperty:function(t){var e=this["get"+t];if("function"==typeof e||"function"==typeof(e=this["is"+t])){for(var i=[],n=1,s=arguments.length;n<s;n++)i.push(arguments[n]);return e.apply(this,i)}},setProperty:function(t,e){var i=this["set"+t];if("function"==typeof i){for(var n=[],s=1,r=arguments.length;s<r;s++)n.push(arguments[s]);return i.apply(this,n)}throw Error(this.getClassName()+"不存在["+t+"]属性!")},setTips:function(t){if(this._form)if(this._form.getItems().length>0){if(this._form.getItems()[0].setPrompt(t),this._form.getItems()[0].isA("MultiFieldFormItem")){var e=this._form.children[0].getItem();if(e.setPrompt(t),e.hasOwnProperty("getItems"))for(var i=0;i<e.length;i++)e[i].setPrompt(t)}}else this._form.setPrompt(t);else this.setPrompt(t),this.children&&this.children.length>0&&this.children[0].setPrompt(t)},setVisible:function(t){this.Visible=t,t?this.show():this.hide()},getVisible:function(){return this.Visible},setTableName:function(t){this.TableName=t},getTableName:function(){return this.TableName},getSourceTableName:function(){return this.SourceTableName},getDock:function(){return this.Dock},setDock:function(t){this.Dock=t},getLayoutType:function(){return this.LayoutType},setLayoutType:function(t){this.LayoutType=t},getPercentWidth:function(){return this.PercentWidth},setPercentWidth:function(t){this.setWidth(t)},getPercentHeight:function(){return this.PercentHeight},setPercentHeight:function(t){this.setHeight(t)},getStaticLayoutSize:function(){return this.StaticLayoutSize},setStaticLayoutSize:function(t){this.StaticLayoutSize=t},addWidgets:function(t,e){t.childrenWidgets||(t.childrenWidgets=[]),t.childrenWidgets.add(e),e.parentWidget=t},parentReadOnly:function(t,e){e||(this._ReadOnly=t,this.canEditReadOnly=!1),this.setHandleReadOnly&&(e&&(this._ReadOnly=t),this.setHandleReadOnly(t,e)),this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",t,e)},isReadOnly:function(){return this._ReadOnly||this.ReadOnly},_performOldReadonlyAction:function(t,e){if(1==t){if(this.isReadOnly())return void(this.ReadOnly=t);this.setHandleReadOnly&&this.setHandleReadOnly(t),this._ReadOnly=t,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",t,e),this.ReadOnly=t}else{if(!this.isReadOnly())return;if(this.parentWidget&&this.parentWidget.isReadOnly())return void(this.ReadOnly=t);this.setHandleReadOnly&&this.setHandleReadOnly(t),this._ReadOnly=t,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",t,e),this.ReadOnly=t}},_performNewReadonlyAction:function(t,e){if(e)this.setHandleReadOnly?this.setHandleReadOnly(t,e):this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",t,e);else if(this.canEditReadOnly=!1,1==t){if(this.isReadOnly()&&!e)return void(this.ReadOnly=t);this.setHandleReadOnly&&!1!==this.canEditReadOnly&&this.setHandleReadOnly(t),this._ReadOnly=t,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",t,e),this.ReadOnly=t}else{if(!this.isReadOnly())return;if(this.parentWidget&&this.parentWidget.isReadOnly()&&!e)return void(this.ReadOnly=t);this.setHandleReadOnly&&!1!==this.canEditReadOnly&&this.setHandleReadOnly(t),this._ReadOnly=t,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",t,e),this.ReadOnly=t}},setReadOnly:function(t,e){isc.isA.Boolean(t)&&this.ReadOnly!=t&&(this.isOldWindowLayoutConfig()?this._performOldReadonlyAction(t,e):this._performNewReadonlyAction(t,e))},parentDisabled:function(t){this.disabled||(this._disabled=t,this.setHandleDisabled&&this.setHandleDisabled(t),this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentDisabled",t))},isDisabled:function(){for(var t=this;t;){if(t._disabled||t.disabled)return!0;(t=t.parentElement)&&t.eventProxy&&(t=t.eventProxy)}return!1},setDisabled:function(t){if(isc.isA.Boolean(t)&&this.disabled!=t)if(1==t){if(this.isDisabled())return void(this.disabled=t);this.setHandleDisabled&&this.setHandleDisabled(t),this._disabled=t,this.disabled=t,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentDisabled",t)}else{if(!this.isDisabled())return;if(this.parentWidget&&this.parentWidget.isDisabled())return void(this.disabled=t);this.setHandleDisabled&&this.setHandleDisabled(t),this._disabled=t,this.disabled=t,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentDisabled",t)}},getPrintTagStartAttributes:function(t){return t?" style='position:absolute;left:"+this.getLeft()+"px;top:"+this.getTop()+"px;width:"+this.getWidth()+"px;height:"+this.getHeight()+"px;' ":this.printChildrenAbsolutelyPositioned?" style='position:relative;width:"+this.getScrollWidth()+"px;height:"+this.getScrollHeight()+"px;' ":null},controlPrintPreview:function(t){isc.Page&&(isc.Page.getScrollTop()>0||isc.Page.getScrollLeft()>0)&&isc.Page.scrollTo(0,0),isc.Canvas.showPrintPreview(t)},controlPrint:function(t){isc.Canvas.printComponents(t)},setControlFocus:function(){this.focus()},getFieldEvent:function(){return this._fieldEvent},setScopeId:function(t){this.scopeId=t},getScopeId:function(){return this.scopeId},setComponentId:function(t){this.componentId=t},getComponentId:function(){if(this.componentId)return this.componentId;if(this.scopeId){var t=this.scopeId.lastIndexOf("_"),e=this.scopeId.substring(t+1,this.scopeId.length);return this.componentId=e,e}return null},show:function(){!0===this._needToBuildRelation&&this.buildRelation(),this.Super("show",arguments)},buildRelation:function(){if(this.getVisible()){var t=this.layoutChildWidgets();if(t&&t.length>0)for(var e=0;a=t[e];e++)this.addV3Child(a);var i=this.getComponentId(),n=isc.JGComponent.getComponentIndex(i),s=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);if(s&&s.length>0){var r;for(e=0;r=s[e];e++){var a,h=isc.WidgetUtils.genWidgetRefId(this.scopeId,r);(a=isc.JGWidgetManager.getWidget(h))&&((this.ReadOnly||this.isReadOnly())&&a.parentReadOnly(!0),(0==this.Enabled||this.isDisabled())&&a.parentDisabled(!0),a.setIndexPreJoinComponentIndex&&a.setIndexPreJoinComponentIndex(n),this.addWidgets(this,a),a.buildRelation())}}}else this._needToBuildRelation=!0},getContentAlignment:function(){return this.ContentAlignment},getHorizontalAlign:function(){return this.HorizontalAlign},getVerticalAlign:function(){return this.VerticalAlign},revert:function(t){if(this.listener)for(var e in this.listener)this.listener[e]=[];if(!1!==t){var i=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);if(i&&i.length>0)for(var n,s=0;n=i[s];s++){var r=isc.WidgetUtils.genWidgetRefId(this.scopeId,n),a=isc.JGWidgetManager.getWidget(r);a&&(a.revert&&a.revert())}}},un:function(t,e){if(t&&e&&e.length>0)for(var i=0,n=e.length;i<n;i++){t[e[i]]=null}},getStaticImagePath:function(t){return t?window&&window._$basePath?window._$basePath+t:t:null},getActiveChildWidgets:function(){return this.getVisible&&this.getVisible()&&this.code?[this.code]:null},getActiveChildWindows:function(){return null},isInLayoutWidget:function(){return"JGGroupPanel"==this.getParentType(this)},getParentType:function(t){var e=t.parentElement;if(e){var i=e.type;i||(i=t.getParentType(t.parentElement))}return i},showHighlight:function(){var t=this.styleName;(t||-1==t.indexOf(" v3ComponentHighlight"))&&(t=t?t+" v3ComponentHighlight":"v3ComponentHighlight",this.setStyleName(t))},hideHighlight:function(){var t=this.styleName;t&&-1!=t.indexOf(" v3ComponentHighlight")&&(t=t.replace(" v3ComponentHighlight",""),this.setStyleName(t))},mapping:function(t,e,i,n){0!=t.length&&t.forEach((function(t){t[e]&&t[e](i,n)}))},validateWidget:function(){if(!1===this.Visible)return!0;var t=!0,e=this.scopeId,i=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);return this.validate&&"function"==typeof this.validate?t=this.validate():i&&$.each(i,(function(i,n){var s=isc.WidgetUtils.genWidgetRefId(e,n),r=isc.JGWidgetManager.getWidget(s);r.validateWidget&&!r.validateWidget()&&(t=!1)})),t}}),isc.ClassFactory.defineInterface("IRecordObserver"),isc.IRecordObserver.addInterfaceMethods({fire:function(t){var e=t.eventName,i=t.datasource;switch(e){case i.Events.LOAD:return this._loadAction.apply(this,[t]);case i.Events.UPDATE:return this._updateAction.apply(this,[t]);case i.Events.DELETE:return this._deleteAction.apply(this,[t]);case i.Events.CURRENT:return this._currentAction.apply(this,[t])}},_loadAction:function(t){t.isAppend||this.clearWidgetData(),this._$fireEventHandler(this.__loadHandler)},_updateAction:function(t){for(var e=t.resultSet,i=t.datasource,n=0,s=e.length;n<s;n++){var r=e[n];if(i.isCurrentRecord(r)){this._handleValue(r),this._isChanged(r)&&this.filterChanged(r)&&this._$fireEventHandler(this.__updateHandler);break}}},filterChanged:function(t){return!0},_isChanged:function(t){var e=this.getBindFields();if(e&&e.length>0)for(var i=0,n=e.length;i<n;i++){var s=e[i];if(t.hasOwnProperty(s))return!0}return!1},_handleValue:function(t){var e=this.getBindFields();if(e&&e.length>0)if(e.length>1){for(var i={},n=0,s=e.length;n<s;n++){var r=e[n];t.hasOwnProperty(r)&&(i[r]=t[r])}this.setWidgetData(i,t)}else{r=e[0];t.hasOwnProperty(r)&&this.setWidgetData(t[r],t)}},_$fireEventHandler:function(t){if(t)for(var e=0,i=t.length;e<i;e++){t[e].apply(this,[])}},_deleteAction:function(){this.clearWidgetData()},_currentAction:function(t){var e=t.currentRecord;this._handleValue(e)},onLoadListener:function(t){"function"==typeof t&&(this.__loadHandler=this.__loadHandler||[],this.__loadHandler.push(t))},onChangedListener:function(t){"function"==typeof t&&(this.__updateHandler=this.__updateHandler||[],this.__updateHandler.push(t))},getBindFields:function(){return[]},setWidgetData:function(t,e){},clearWidgetData:function(){}}),isc.ClassFactory.defineClass("CurrentRecordObserver"),isc.CurrentRecordObserver.addProperties({fields:null,setValueHandler:null,clearValueHandler:null}),isc.CurrentRecordObserver.addMethods({fire:function(t){var e=t.eventName,i=t.datasource;switch(e){case i.Events.LOAD:return this._loadAction.apply(this,[t]);case i.Events.UPDATE:return this._updateAction.apply(this,[t]);case i.Events.DELETE:return this._deleteAction.apply(this,[t]);case i.Events.CURRENT:return this._currentAction.apply(this,[t])}},_loadAction:function(t){t.isAppend||this._fireHandler(this.clearValueHandler,[])},_updateAction:function(t){for(var e=t.resultSet,i=t.datasource,n=0,s=e.length;n<s;n++){var r=e[n];if(i.isCurrentRecord(r)){this._handleValue(r);break}}},_isChanged:function(t){var e=this.getBindFields();if(e&&e.length>0)for(var i=0,n=e.length;i<n;i++){var s=e[i];if(t.hasOwnProperty(s))return!0}return!1},_handleValue:function(t){this._isChanged(t)&&this._fireHandler(this.setValueHandler,[t])},_fireHandler:function(t,e){t&&t.apply(this,e)},_deleteAction:function(){this._fireHandler(this.clearValueHandler,[])},_currentAction:function(t){var e=t.currentRecord;this._handleValue(e)},getBindFields:function(){return this.fields||[]},setWidgetValueHandler:function(t){this.setValueHandler=t},clearWidgetValueHandler:function(t){this.clearValueHandler=t}}),isc.ClassFactory.defineInterface("IDatasourceObserver"),isc.IDatasourceObserver.addInterfaceMethods({fire:function(t){var e=t.eventName,i=t.datasource;switch(e){case i.Events.LOAD:return this._fireHandler(this._v3LoadHandler,t);case i.Events.INSERT:return this._fireHandler(this._v3InsertHandler,t);case i.Events.UPDATE:return this._fireHandler(this._v3UpdateHandler,t);case i.Events.DELETE:return this._fireHandler(this._v3DeleteHandler,t);case i.Events.CURRENT:return this._fireHandler(this._v3CurrentHandler,t);case i.Events.SELECT:return this._fireHandler(this._v3SelectHandler,t);case i.Events.FETCH:return this._fireHandler(this._v3FetchHandler,t);case i.Events.FETCHED:return this._fireHandler(this._v3FetchedHandler,t)}},setLoadHandler:function(t){this._v3LoadHandler=t},setInsertHandler:function(t){this._v3InsertHandler=t},setUpdateHandler:function(t){this._v3UpdateHandler=t},setDeleteHandler:function(t){this._v3DeleteHandler=t},setCurrentHandler:function(t){this._v3CurrentHandler=t},setSelectHandler:function(t){this._v3SelectHandler=t},setFetchHandler:function(t){this._v3FetchHandler=t},setFetchedHandler:function(t){this._v3FetchedHandler=t},_fireHandler:function(t,e){"function"==typeof t&&t.call(this,e)}}),isc.ClassFactory.defineClass("WidgetDatasource"),isc.WidgetDatasource.addClassMethods({_getDatasource:function(t,e){null!=e&&null!=e||(e=t.TableName)},_getFields:function(t,e){if(null==e||null==e){if(!t.getBindFields)throw Error("控件未提供getBindFields接口，无法绑定更新回调！控件类型："+t.getClassName());e=t.getBindFields()}return Array.isArray(e)&&(e=[e]),e},addBindDatasourceCurrentRecordUpdateEventHandler:function(t,e,i,n){if(e=isc.WidgetDatasource._getDatasource(t,e)){i=isc.WidgetDatasource._getFields(t,i);var s=isc.CurrentRecordObserver.create({fields:i,setValueHandler:n});e.addObserver(s)}},addBindDatasourceCurrentRecordClearEventHandler:function(t,e,i,n){if(e=isc.WidgetDatasource._getDatasource(t,e)){i=isc.WidgetDatasource._getFields(t,i);var s=isc.CurrentRecordObserver.create({fields:i,clearValueHandler:n});e.addObserver(s)}}}),isc.ClassFactory.defineClass("DataBindingUtil"),isc.DataBindingUtil.addClassMethods({_getVM:function(t){var e=t.TableName,i=isc.JGV3ValuesManager.genId(e.ID,t.scopeId,t.code);return isc.JGV3ValuesManager.getById(i,e)},_filterData:function(t,e){for(var i={},n=0,s=t.length;n<s;n++){var r=t[n];i[r]=e[r]}return i.id=e.id,i},setWidgetValue:function(t,e){var i=isc.DataBindingUtil._getVM(t);if(!t.getBindFields)throw Error("控件未提供getBindFields接口，无法绑定更新回调！控件类型："+t.getClassName());var n=t.getBindFields();i.setFieldCodes&&i.setFieldCodes([].concat(n));var s=i.getValues(),r={};for(var a in s&&Object.assign(r,s),r)r.hasOwnProperty(a)&&"id"!=a&&-1==n.indexOf(a)&&delete r[a];var h=isc.DataBindingUtil._filterData(n,e);for(var a in h)h.hasOwnProperty(a)&&(r[a]=h[a]);i.editRecord(r)},clearWidgetValue:function(t){isc.DataBindingUtil._getVM(t).clearValues()}})}));
